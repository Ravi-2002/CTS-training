import React from "react";
import { render } from "@testing-library/react";
import BlockCallsMessages from "../BlockCallsMessages"; // adjust path
import { Provider } from "react-redux";
import configureStore from "redux-mock-store";

const mockStore = configureStore([]);
let store;

describe("BlockCallsMessages handleInput tests", () => {
  beforeEach(() => {
    store = mockStore({
      Detail: {
        callsMsgs: {
          callsMessages: {},
          blockedNumbers: [],
          expiredNumbers: [],
          getCMError: {},
          blockAgainResponse: {},
          addBlockCallMsg: {},
          editBlockCallMsg: {},
          deleteBlockCallMsg: {},
          editAllBlockCallMsg: {},
          isFetching: false,
        },
        devices: [],
      },
    });
  });

  it("updates state for valid 10-digit number", () => {
    const wrapper = render(
      <Provider store={store}>
        <BlockCallsMessages selectedDevice={{ encryptedMtn: "mockMtn" }} />
      </Provider>
    );

    const instance = wrapper.container.firstChild._reactInternals.return.stateNode;

    // simulate handleInput with valid 10-digit number
    instance.setState({ newNumber: "123.456.7890" });
    const event = { target: { value: "123.456.7890" } };

    instance.handleInput(event, "number");

    expect(instance.state.newNumber).toBe("123.456.7890");
    expect(instance.state.addnumberValid).toBe(true);
  });

  it("marks addnumberValid false for invalid number", () => {
    const wrapper = render(
      <Provider store={store}>
        <BlockCallsMessages selectedDevice={{ encryptedMtn: "mockMtn" }} />
      </Provider>
    );

    const instance = wrapper.container.firstChild._reactInternals.return.stateNode;

    // invalid number <10 digits
    instance.setState({ newNumber: "123.45" });
    const event = { target: { value: "123.45" } };

    instance.handleInput(event, "number");

    expect(instance.state.addnumberValid).toBe(false);
  });

  it("updates applyAllFlag for checkbox input", () => {
    const wrapper = render(
      <Provider store={store}>
        <BlockCallsMessages selectedDevice={{ encryptedMtn: "mockMtn" }} />
      </Provider>
    );

    const instance = wrapper.container.firstChild._reactInternals.return.stateNode;
    const event = { target: { checked: true } };

    instance.handleInput(event, "checkbox");

    expect(instance.state.applyAllFlag).toBe(true);
  });
});