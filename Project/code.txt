import React, { useState, useEffect } from "react";
import { useDispatch, useSelector } from "react-redux";
import { Title, Body } from "@vds/typography";
import { Input } from "@vds/inputs";
import { Button, TextLink } from "@vds/buttons";
import { Loader } from "@vds/loaders";
import styled from "styled-components";
import {
  getCallsMessages,
  postaddBlockCallMsg,
} from "../actions/fetchCallsMessages";
import { useLocation } from "react-router-dom/cjs/react-router-dom.min";

const BlockCallsEmpty = ({ history }) => {
  const dispatch = useDispatch();
  const [phoneNumber, setPhoneNumber] = useState("");

  const { blockedNumbers, addBlockCallMsg, isFetching } = useSelector((state) => state.Detail);

  useEffect(() => {
    dispatch(getCallsMessages());
  }, [dispatch]);
  const location = useLocation();
  console.log(location,'location')
  const allowInput = location.state?.allowInput??false;
  useEffect(() => {
    if (
      (!allowInput&&blockedNumbers.length > 0 )
    ) {
      history.push("/call-message-blocking");
    }
  }, [blockedNumbers,allowInput, history]);

  const handleAdd = () => {
    dispatch(postaddBlockCallMsg({ phoneNumber, reason: "Blocked manually" }));
    console.log(addBlockCallMsg,'addblock')
    history.push('/call-message-blocking')
    setPhoneNumber("");
  };

  return (
    <PageWrapper>
      <Loader active={isFetching} fullscreen />
      <Title size="large" bold>Block calls and messages from up to 5 numbers.</Title>
      <p className="text-muted mb-4">732.609.9414</p>

      <Body>Enter phone number</Body>
      <Input
        value={phoneNumber}
        maxLength={10}
        onChange={(e) => setPhoneNumber(e.target.value)}
      />

      <ButtonWrapper>
        <Button
          disabled={!phoneNumber.trim()}
          onClick={handleAdd}
        >
          Block number
        </Button>
      </ButtonWrapper>

      <Body className="mt-4 text-muted">
        There is no charge to block.{" "}
        <TextLink
          type="standAlone"
          surface="light"
          onClick={() => history.push("/viewlimitation")}
        >
          View Limitations
        </TextLink>
      </Body>
    </PageWrapper>
  );
};

const PageWrapper = styled.div` padding: 20px; `;
const ButtonWrapper = styled.div` display: flex; justify-content: center; padding: 20px 0; `;

export default BlockCallsEmpty;
