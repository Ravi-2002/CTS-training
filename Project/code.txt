@Service
public class WebAuthUserService
        implements PublicKeyCredentialUserEntityRepository {

    @Autowired
    private UserRepository userRepository;

    // ðŸ”¹ FIND BY USERNAME (email)
    @Override
    public PublicKeyCredentialUserEntity findByUsername(String username) {

        return userRepository.findByEmail(username)
                .map(user ->
                        PublicKeyCredentialUserEntity.builder()
                                .id(user.getUserHandle())
                                .name(user.getEmail())
                                .displayName(user.getEmail())
                                .build()
                )
                .orElse(null);
    }

    // ðŸ”¹ FIND BY USER HANDLE
    @Override
    public PublicKeyCredentialUserEntity findById(byte[] userHandle) {

        List<User> users = userRepository.findAll();

        return users.stream()
                .filter(user ->
                        Arrays.equals(user.getUserHandle(), userHandle)
                )
                .findFirst()
                .map(user ->
                        PublicKeyCredentialUserEntity.builder()
                                .id(user.getUserHandle())
                                .name(user.getEmail())
                                .displayName(user.getEmail())
                                .build()
                )
                .orElse(null);
    }

    // ðŸ”¹ REQUIRED METHOD â€” THIS WAS MISSING
    @Override
    public void save(PublicKeyCredentialUserEntity entity) {

        User user = new User();
        user.setEmail(entity.getName());
        user.setUserHandle(entity.getId());

        userRepository.save(user);
    }
}