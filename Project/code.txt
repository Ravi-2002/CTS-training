import React from "react";
import { shallow } from "enzyme";
import BlockServices from "../BlockServices";

describe("BlockServices toggleOn() coverage", () => {
  it("covers postServices and pendingService setState", () => {
    const mockPostServices = jest.fn().mockResolvedValue({ responseCode: "00" });

    const props = {
      selectedDevice: { encryptedMtn: "ENC123" },
      actions: { postServices: mockPostServices },
    };

    const wrapper = shallow(<BlockServices {...props} />);
    const instance = wrapper.instance();

    // Prepare state
    instance.setState({
      services: {
        broadband: { data: [{ sfoEnabled: "Y", sfoCode: "CODE1" }] },
      },
    });

    const mockEvent = { preventDefault: jest.fn() };

    // âœ… Return the Promise so Jest waits automatically
    return instance.toggleOn(mockEvent, "broadband", 0).then(() => {
      // Verify the async call and state update
      expect(mockPostServices).toHaveBeenCalledWith({
        mdn: "ENC123",
        sfoCode: "CODE1",
        sfoEnabled: "N",
      });

      expect(instance.state.pendingService).toEqual({
        service: "broadband",
        i: 0,
      });
    });
  });
});