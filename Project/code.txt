import React from "react";
import { render } from "@testing-library/react";
import BlockCallsMessages from "../BlockCallsMessages"; // adjust path
import { Provider } from "react-redux";
import configureStore from "redux-mock-store";

const mockStore = configureStore([]);
let store;

describe("BlockCallsMessages handleOnChange tests", () => {
  beforeEach(() => {
    store = mockStore({
      Detail: {
        callsMsgs: {
          callsMessages: {},
          blockedNumbers: [],
          expiredNumbers: [],
          getCMError: {},
          blockAgainResponse: {},
          addBlockCallMsg: {},
          editBlockCallMsg: {},
          deleteBlockCallMsg: {},
          editAllBlockCallMsg: {},
          isFetching: false,
        },
        devices: [],
      },
    });
  });

  it("formats number input correctly and updates state", () => {
    const wrapper = render(
      <Provider store={store}>
        <BlockCallsMessages selectedDevice={{ encryptedMtn: "mockMtn" }} />
      </Provider>
    );

    const instance = wrapper.container.firstChild._reactInternals.return.stateNode;

    const mockEvent = { target: { value: "1234567890" } };

    // Call handleOnChange directly
    instance.handleOnChange(mockEvent, "number");

    // State should now have formatted number
    expect(instance.state.newNumber).toBe("123.456.7890");
  });

  it("formats partial number input correctly", () => {
    const wrapper = render(
      <Provider store={store}>
        <BlockCallsMessages selectedDevice={{ encryptedMtn: "mockMtn" }} />
      </Provider>
    );

    const instance = wrapper.container.firstChild._reactInternals.return.stateNode;

    const mockEvent = { target: { value: "12345" } };

    instance.handleOnChange(mockEvent, "number");

    expect(instance.state.newNumber).toBe("123.45");
  });

  it("calls handleInput internally", () => {
    const wrapper = render(
      <Provider store={store}>
        <BlockCallsMessages selectedDevice={{ encryptedMtn: "mockMtn" }} />
      </Provider>
    );

    const instance = wrapper.container.firstChild._reactInternals.return.stateNode;

    // Spy on handleInput
    const spy = jest.spyOn(instance, "handleInput");

    const mockEvent = { target: { value: "9876543210" } };
    instance.handleOnChange(mockEvent, "number");

    expect(spy).toHaveBeenCalledWith(mockEvent, "number", undefined);
  });
});